function clearActive(e){let t=document.getElementById(e);for(;t.firstChild;)t.removeChild(t.firstChild)}function makeUl(e,t){let n=document.createElement("h1");n.innerHTML=capitalizeFirstLetter(e);let a=document.createElement("ul");a.id=e,t.appendChild(n),t.appendChild(a)}function makeLi(e,t,n,a){e.toLowerCase()==user.name&&(document.getElementById("rad"+capitalizeFirstLetter(a)).checked=!0);let o=document.createElement("li");o.innerHTML=e,document.getElementById(a).appendChild(o)}function makeOption(e,t,n){let a=document.createElement("option");a.value=e,a.name="date"+t,a.id="date"+t,a.innerText=makeUTCdate(e),n.appendChild(a)}function makeDatePicker(e){let t=document.getElementById("datePicker");for(let n=0;n<e.length;n++)makeOption(e[n].date,n,t)}function makeUTCdate(e){let t=new Date(0);return t.setUTCSeconds(e),t=t.toString(),t=t.split(" ").splice(0,5).join(" ")}function getDateData(){let e=document.getElementById("date").getElementsByTagName("input"),t={};for(let n=0;n<e.length;n++)t[e[n].name]=e[n].value;addDate(new Date(t.year,t.month-1,t.day,t.hours,t.minutes).getTime()/1e3)}function handleRadClick(e){const t=document.getElementById("datePicker");var n=user.name,a=t.value;t.value&&setAvailibility({name:n,date:a,availability:e.value})}function addDate(e){fetch("https://calendnyan.herokuapp.com/dates/addDate/"+e,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",jwt:JSON.parse(window.token)}}).then(e=>e.json()).then(function(){let t=document.getElementById("datePicker"),n=t.children.length+1;makeOption(e,n,t),t.selectedIndex=n-1}).then(function(){loadCurrent()}).catch(()=>{})}function removeDate(e){fetch("https://calendnyan.herokuapp.com/dates/removeDate/"+e,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",jwt:JSON.parse(window.token)}}).then(e=>e.json()).then(function(e){if(1==e.succes){let e=document.getElementById("datePicker"),t=e.selectedIndex+1;e.removeChild(e.childNodes[t])}}).then(function(){loadCurrent()}).catch(()=>{})}function loadActive(e,t){unCheckBoxes(),fetch("https://calendnyan.herokuapp.com/dates/getDates/"+e).then(e=>e.json()).then(function(n){var a=document.createElement("h2"),o=makeUTCdate(e);a.innerText=o,t.appendChild(a);for(property in n){var i=property;makeUl(property,t),n[i].forEach((e,t,n)=>makeLi(e,t,n,property))}}).catch(()=>{})}function setAvailibility(e){fetch("https://calendnyan.herokuapp.com/dates/setAvailability",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json",jwt:JSON.parse(window.token)},body:JSON.stringify(e)}).then(e=>e.json()).then(function(t){moveLi(e)}).catch(()=>{})}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function moveLi(e){let t=getCurrentUl(user.name);"yes"==t.found&&t.li.parentNode.removeChild(t.li),document.getElementById(revertAvailabilty(e.availability)).appendChild(t.li)}function revertAvailabilty(e){switch(e){case"0":return"available";case"1":return"unavailable";case"2":return"tentative"}}function getCurrentUl(e){var t=document.getElementById("dataView").getElementsByTagName("ul");for(let n=0;n<t.length;n++)for(let o=0;o<t[n].children.length;o++)if(t[n].children[o].innerText==e)return a={found:"yes",li:t[n].children[o]};var n=document.createElement("li");n.innerText=e;var a={found:"no",li:n};return a}function loadCurrent(){document.getElementById("datePicker");clearActive("dataView"),loadActive(datePicker.value,dataView)}function unCheckBoxes(){var e=document.getElementById("availability").getElementsByTagName("input");for(let t=0;t<e.length;t++)e[t].checked=!1}function login(){var e=document.getElementById("login");clearErrorMsgs(e);var t=e.getElementsByTagName("input"),n={count:0};for(let e=0;e<t.length;e++)t[e].classList.remove("error"),0==t[e].value.length&&(t[e].classList.add("error"),n.count++,n[t[e].name]={error:"missing input",msg:"missing input",input:t[e]});for(let e=0;e<t.length;e++)if(!n[t[e].name])switch(t[e].name){case"email":validateEmail(t[e].value)||(n[t[e].name]={error:"formatting",msg:"not a correct emailadress",input:t[e]},t[e].classList.add("error"),n.count++)}if(0==n.count){let e={};for(let n=0;n<t.length;n++)e[t[n].name]=t[n].value;e.email=e.email.toLowerCase(),fetch("https://calendnyan.herokuapp.com/users/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(function(e){e.success?(localStorage.setItem("token",JSON.stringify(e.token)),localStorage.setItem("userInfo",JSON.stringify(e.user)),loggedInCheck()):alert(e.msg)}).catch(()=>{})}else{clearErrorMsgs(e);for(key in n)if("count"!==key){var a=n[key];makeMsg(a.input.parentNode,a.msg)}}}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function hasClass(e,t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)}function makeMsg(e,t){eSpan=document.createElement("span"),eSpan.className="errorMsg",eSpan.innerText=t,e.appendChild(eSpan)}function clearErrorMsgs(e){let t=e.getElementsByClassName("errorMsg");for(let e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])}function loggedInCheck(){if(localStorage.getItem("token")){window.token=localStorage.getItem("token");let e=JSON.parse(localStorage.getItem("userInfo"));user=e,changeState()}}function changeState(){clearActive("loginInnerContent"),createLogout(document.getElementById("loginInnerContent")),checkType()}function createLogout(e){eDiv=document.createElement("div"),eDiv.className="logout",eButton=document.createElement("button"),eButton.id="logout",eButton.innerText="logout",eButton.addEventListener("click",function(){logout()}),eSpan=document.createElement("span"),eSpan.innerText="Logged in as "+user.name,eDiv.appendChild(eSpan),eDiv.appendChild(eButton),e.appendChild(eDiv)}function logout(){localStorage.removeItem("token"),localStorage.removeItem("userInfo"),user={},location.reload()}function checkType(){switch(user.type){case"admin":let e=document.getElementsByClassName("adminContent");for(let t=0;t<e.length;t++)e[t].style.display="block";default:document.getElementById("availability").style.display="block"}}function register(){document.getElementById("registerInnerContent").style.display="block"}function regSubmit(){var e=document.getElementById("register"),t=document.getElementById("login");clearErrorMsgs(e);var n=e.getElementsByTagName("input"),a={count:0};for(let e=0;e<n.length;e++)n[e].classList.remove("error"),0==n[e].value.length&&(n[e].classList.add("error"),a.count++,a[n[e].name]={error:"missing input",msg:"missing input",input:n[e]});for(let e=0;e<n.length;e++)if(!a[n[e].name])switch(n[e].name){case"regemail":validateEmail(n[e].value)||(a[n[e].name]={error:"formatting",msg:"not a valid emailadress - check the formatting",input:n[e]},n[e].classList.add("error"),a.count++)}if(0==a.count){let e={};for(let t=0;t<n.length;t++)e[n[t].name]=n[t].value;e.regemail=e.regemail.toLowerCase(),fetch("https://calendnyan.herokuapp.com/users/register",{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(function(e){e.success?(alert("registered, you can log in now."),document.getElementById("registerInnerContent").style.display="none"):alert(e.msg)}).catch(()=>{})}else{clearErrorMsgs(t);for(key in a)if("count"!==key){var o=a[key];makeMsg(o.input.parentNode,o.msg)}}}user={},window.onload=function(){const e=document.getElementById("dataView"),t=document.getElementById("datePicker"),n=document.getElementById("addDate"),a=document.getElementById("removeDate"),o=(document.getElementById("availability"),document.getElementById("btnLogin")),i=document.getElementById("btnRegister");loggedInCheck(),fetch("https://calendnyan.herokuapp.com/dates/getDates").then(e=>e.json()).then(function(e){makeDatePicker(e),loadCurrent()}).catch(()=>{}),t.addEventListener("change",function(){e.children.length>0&&clearActive(e.id),loadActive(t.value,e)}),n.addEventListener("click",function(e){getDateData()}),a.addEventListener("click",function(e){t.value&&removeDate(t.value)}),o.addEventListener("click",function(e){login()}),i.addEventListener("click",function(e){register()})};